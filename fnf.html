<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FNF' - Mobile</title>

  <style>
    @font-face {
      font-family: "MiFuente";
      src: url("assets/fonts/funkin.ttf") format("opentype");
      font-weight: normal;
      font-style: normal;
    }

    body {
      font-family: "MiFuente", system-ui, -apple-system, sans-serif;
    }

    :root {
      --text: #e0e0e0;
      --card-bg: rgba(0, 0, 0, 0.55);
      --neon-blue: #00eaff;
      --neon-pink: #ff00c8;
      --neon-purple: #b400ff;
      --bg: linear-gradient(45deg, #0f0f0f, #000428, #1a1a1a);
    }

    body.light {
      --text: #1a1a1a;
      --card-bg: rgba(255,255,255,0.7);
      --bg: linear-gradient(45deg, #e6f7ff, #ffffff, #f0f0f0);
    }

    body {
      margin: 0;
      color: var(--text);
      background: linear-gradient(45deg, #0f0f0f, #000638, #1a1a1a);
      background-size: 600% 600%;
      animation: moveBg 12s ease infinite;
    }
    @keyframes moveBg {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    body::before {
      content: "";
      position: fixed;
      inset: 0;
      z-index: -1;
      background: radial-gradient(circle at 20% 30%, rgba(0, 255, 255, 0.295), transparent 60%),
                  radial-gradient(circle at 80% 70%, rgba(255, 0, 200, 0.288), transparent 60%),
                  radial-gradient(circle at 50% 50%, rgba(179, 0, 255, 0.267), transparent 70%);
      filter: blur(80px);
      animation: nebulaMove 10s ease-in-out infinite alternate;
    }

    .container {
      max-width:1100px;
      margin:40px auto;
      background:var(--card-bg);
      padding:24px;
      border-radius:14px;
      backdrop-filter:blur(12px);
      box-shadow:0 0 25px rgba(0,0,0,.6);
    }

    @keyframes nebulaMove {
      0% { transform: translate(-40px, -40px) scale(1.1); opacity: 0.7; }
      50% { transform: translate(40px, 20px) scale(1.3); opacity: 1; }
      100% { transform: translate(-20px, 40px) scale(1.2); opacity: 0.8; }
    }

    .glow {
      color: white;
      text-shadow: 0 0 10px var(--neon-blue), 0 0 20px var(--neon-blue), 0 0 40px var(--neon-purple), 0 0 80px var(--neon-purple);
    }

    .admin-name {
      color: #b9f2ff !important;
      text-shadow: 0 0 5px #fff, 0 0 10px #00eaff, 0 0 20px #00eaff !important;
      font-weight: bold;
      animation: sparkle 1s infinite alternate;
      cursor: pointer;
    }
    @keyframes sparkle {
      0% { filter: brightness(1) drop-shadow(0 0 2px #fff); }
      100% { filter: brightness(1.5) drop-shadow(0 0 10px #00eaff); }
    }

    .theme-btn {
      font-size:30px; cursor:pointer; animation: spinGlow 6s linear infinite; filter: drop-shadow(0 0 6px var(--neon-blue));
      position: fixed; top: 20px; right: 20px; z-index: 10000; background: rgba(0,0,0,0.3); width: 50px; height: 50px;
      display: flex; align-items: center; justify-content: center; border-radius: 50%; border: 1px solid var(--neon-blue);
    }

    @keyframes spinGlow { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

    .menu-btn { width:32px; height:26px; display:flex; flex-direction:column; justify-content:space-between; cursor:pointer; }
    .menu-btn div { height:4px; background: white; border-radius:4px; box-shadow:0 0 6px var(--neon-blue); }

    #menuPopup { position: fixed; inset: 0; display: flex; justify-content: center; align-items: center; background: rgba(0,0,0,0.85); z-index: 9999; opacity: 0; pointer-events: none; transition: .3s ease; }
    #menuPopup.show { opacity: 1; pointer-events: auto; }
    #menuContent { width: 80%; max-width: 360px; background: rgba(15,15,15,0.95); padding: 25px; border-radius: 14px; text-align: center; border: 2px solid var(--neon-blue); box-shadow: 0 0 25px var(--neon-blue); }
    .menu-option { display:block; margin:18px 0; padding:12px; font-size:20px; font-weight:600; color:white; border-radius:10px; text-shadow:0 0 10px var(--neon-blue); border:1px solid var(--neon-blue); cursor:pointer; background: rgba(0,0,0,0.45); }
    #closeMenuPopup { margin-top:18px; font-size:22px; cursor:pointer; color:var(--neon-pink); text-shadow:0 0 10px var(--neon-pink); }

    .apks-grid, .mods-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); gap:24px; margin-top:20px; }
    .apk-card, .mod-card { background: rgba(0,0,0,0.45); padding:18px; border-radius:12px; border:1px solid var(--neon-blue); box-shadow:0 0 15px var(--neon-blue); text-align:center; position: relative; }
    .apk-card img, .mod-card img { width:100%; height:150px; object-fit:cover; border-radius:10px; margin-bottom:14px; box-shadow:0 0 12px var(--neon-blue); }

    .like-container { position: absolute; top: 10px; left: 10px; background: rgba(0,0,0,0.6); padding: 5px 10px; border-radius: 20px; display: flex; align-items: center; gap: 5px; border: 1px solid var(--neon-pink); cursor: pointer; z-index: 5; transition: 0.3s; }
    .like-icon { color: #555; transition: 0.3s; }
    .like-container.active { border-color: var(--neon-pink); background: rgba(255, 0, 200, 0.2); }
    .like-container.active .like-icon { color: var(--neon-pink); text-shadow: 0 0 10px var(--neon-pink); }
    .like-count { font-size: 14px; color: white; }

    .coming-soon-card { background: rgba(40, 0, 40, 0.4); border: 1px dashed var(--neon-pink); box-shadow: 0 0 10px var(--neon-pink); opacity: 0.8; position: relative; overflow: hidden; }
    .coming-soon-card img { filter: blur(8px) grayscale(1); }
    .coming-soon-badge { position: absolute; top: 10px; right: -30px; background: var(--neon-pink); color: white; padding: 5px 40px; transform: rotate(45deg); font-size: 12px; font-weight: bold; box-shadow: 0 0 10px var(--neon-pink); }

    .btn { display:inline-block; padding:10px 16px; margin-top:10px; border-radius:8px; background: var(--neon-pink); color:white; font-weight:600; text-decoration:none; box-shadow:0 0 12px var(--neon-pink); cursor: pointer; border:none; }

    .popup { position: fixed; inset: 0; background: rgba(0, 0, 0, 0.85); display: flex; justify-content: center; align-items: center; z-index: 999; opacity: 0; pointer-events: none; transition: opacity .3s ease; }
    .popup.show { opacity: 1; pointer-events: auto; }

    .popup-content { 
      width: 85%; 
      max-width: 450px; 
      background: rgba(10,10,10,0.95); 
      border-radius: 15px; 
      position: relative; 
      border: 2px solid var(--neon-blue); 
      box-shadow: 0 0 25px var(--neon-blue); 
      color: white;
      max-height: 85vh; 
      display: flex;
      flex-direction: column;
      overflow: hidden; 
    }

    .popup-scroll-body {
      padding: 20px;
      overflow-y: auto;
      flex: 1;
    }

    .popup-scroll-body::-webkit-scrollbar { width: 6px; }
    .popup-scroll-body::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.05); }
    .popup-scroll-body::-webkit-scrollbar-thumb { 
      background: var(--neon-blue); 
      border-radius: 10px; 
      box-shadow: 0 0 10px var(--neon-blue); 
    }

    @media screen and (min-width: 768px) {
      .popup-content { max-width: 800px; }
    }

    .popup-close { position: absolute; top: 8px; right: 10px; font-size: 26px; cursor: pointer; color: var(--neon-blue); z-index: 100; background: rgba(0,0,0,0.5); border-radius: 50%; width: 35px; height: 35px; display: flex; align-items: center; justify-content: center; }
    .popup-content img { width: 100%; border-radius: 10px; margin-bottom: 10px; object-fit: contain; max-height: 350px; }

    .social-grid { display: flex; flex-wrap: wrap; gap: 20px; justify-content: center; margin-top: 30px; }
    .social-item { display: flex; flex-direction: column; align-items: center; background: rgba(0,0,0,0.6); padding: 20px; border-radius: 15px; border: 2px solid var(--neon-blue); box-shadow: 0 0 15px var(--neon-blue); transition: all 0.3s ease; width: 140px; }
    .social-item:hover { transform: translateY(-10px) scale(1.05); box-shadow: 0 0 25px var(--neon-pink); border-color: var(--neon-pink); }
    .social-item img { width: 60px; height: 60px; border-radius: 12px; margin-bottom: 15px; box-shadow: 0 0 10px var(--neon-blue); }

    .section { display:none; }
    .active{ display:block; }

    .visitor-counter { margin-top: 15px; font-size: 14px; color: var(--neon-blue); text-shadow: 0 0 5px var(--neon-blue); border: 1px solid var(--neon-blue); display: inline-block; padding: 5px 15px; border-radius: 20px; background: rgba(0,0,0,0.3); }

    .yt-comment-container { display: flex; gap: 12px; margin-bottom: 20px; align-items: flex-start; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 15px; text-align: left; }
    .yt-avatar { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; color: #000; flex-shrink: 0; }
    .yt-content { flex: 1; }
    .yt-header { display: flex; align-items: center; gap: 8px; margin-bottom: 4px; font-size: 13px; }
    .yt-name { color: white; font-weight: bold; }
    .yt-name-link { text-decoration: none; color: inherit; }
    .yt-name-link:hover { text-decoration: underline; color: var(--neon-blue); }
    .yt-date { color: #aaa; font-size: 11px; }
    .yt-text { font-size: 14px; color: #eee; line-height: 1.4; margin-bottom: 8px; font-family: sans-serif; }
    .yt-actions { display: flex; align-items: center; gap: 15px; font-size: 12px; color: #aaa; }
    .yt-action-btn { cursor: pointer; transition: 0.2s; display: flex; align-items: center; gap: 4px; }
    .yt-action-btn.active { color: var(--neon-pink); font-weight: bold; }
    .yt-action-btn:hover { color: var(--neon-blue); }

    .reg-input { width: 100%; background: rgba(255,255,255,0.05); border: 1px solid var(--neon-blue); border-radius: 8px; padding: 12px; color: white; margin-bottom: 15px; box-sizing: border-box; }

    #commentList {
      max-height: 500px;
      overflow-y: auto;
      padding-right: 10px;
      margin-top: 10px;
    }

    #commentList::-webkit-scrollbar { width: 6px; }
    #commentList::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.05); border-radius: 10px; }
    #commentList::-webkit-scrollbar-thumb { background: var(--neon-blue); border-radius: 10px; box-shadow: 0 0 10px var(--neon-blue); }
  </style>
</head>

<body>

  <div class="theme-btn" onclick="toggleTheme()">‚òº</div>

  <div id="ban-popup" class="popup">
    <div class="popup-content" style="padding: 20px;">
      <h2 class="glow" style="text-align: center;">üî® Control de Baneo</h2>
      <p id="ban-target-info" style="font-size: 14px; margin-bottom: 15px; color: var(--neon-pink);"></p>
      <input type="text" id="banReason" class="reg-input" placeholder="Motivo del baneo">
      <input type="number" id="banDuration" class="reg-input" placeholder="Horas (ej: 24)" value="24">
      <button class="btn" id="confirmBanBtn" style="width: 100%; background: red;">Banear Usuario</button>
      <button class="btn" onclick="document.getElementById('ban-popup').classList.remove('show')" style="width: 100%; background: #444; margin-top: 10px;">Cancelar</button>
    </div>
  </div>

  <div id="admin-popup" class="popup">
    <div class="popup-content" style="text-align: center; padding: 20px;">
      <h2 class="glow">Acceso Superusuario</h2>
      <p>Introduce el c√≥digo de seguridad:</p>
      <input type="password" id="adminCode" class="reg-input" placeholder="C√≥digo">
      <button class="btn" onclick="verifyAdmin()" style="width: 100%">Entrar</button>
      <p onclick="document.getElementById('admin-popup').classList.remove('show')" style="cursor:pointer; color:gray; font-size:12px; margin-top:10px;">Cancelar</p>
    </div>
  </div>

  <div id="update-popup" class="popup">
    <div class="popup-content" style="text-align: center;">
      <h2 class="glow" style="margin-top:10px;">¬°Novedades!</h2>
      <p>Que hay de nuevo en esta versi√≥n:</p>
      <ul class="news-list">
        <li>üÜï Nuevo Mod A√±adido</li>
        <li>üÜï Nuevo dise√±o en el apartado de comunidad. (Estado: Beta)</li>
        <li>üõ†Ô∏è Correcci√≥n de errores menores y mejoras.</li>
      </ul>
      <button class="btn" onclick="closeUpdatePopup()" style="width: 100%; padding: 15px; font-size: 13px;">¬°Entendido!</button>
    </div>
  </div>

  <div id="register-popup" class="popup">
    <div class="popup-content" style="text-align: center; padding: 20px;">
      <h2 class="glow">Registro de Usuario</h2>
      <p style="font-size: 13px; margin-bottom: 20px;">Reg√≠strate para poder continuar.</p>
      <input type="text" id="regName" class="reg-input" placeholder="Tu Apodo (ej: LaloCF)">
      <input type="url" id="regLink" class="reg-input" placeholder="Link de tu Canal o Perfil (Opcional)">
      <button class="btn" onclick="saveRegistration()" style="width: 100%">Aceptar</button>
    </div>
  </div>

  <div id="menuPopup">
    <div id="menuContent">
      <h2 class="glow">Men√∫</h2>
      <div class="menu-option" onclick="selectSection('apks')">Bases</div>
      <div class="menu-option" onclick="selectSection('mods')">MODs</div>
      <div class="menu-option" onclick="selectSection('comments-area')">Comunidad (Beta)</div>
      <div class="menu-option" onclick="selectSection('contact')">Contacto</div>
      <div id="closeMenuPopup" onclick="toggleMenu()">‚úñ</div>
    </div>
  </div>

  <div class="container">
    <header style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
      <div class="menu-btn" onclick="toggleMenu()"><div></div><div></div><div></div></div>
      <h1 class="glow" id="fnf-title" style="user-select:none; cursor:pointer;">Friday Night Funkin'</h1>
    </header>

    <section id="welcome">
      <h1>Bienvenido a FNF' - Mobile</h1>
      <p>Tu rinc√≥n de mods para Friday Night Funkin' Mobile. ¬°Explora y descarga!</p>
    </section>

    <section id="apks" class="section active">
      <h2 class="glow">Descargas</h2>
      <div class="apks-grid">
        <div class="apk-card">
          <div class="like-container" id="like-apk1" onclick="handleLike('apk1', this)"><span class="like-icon">‚ù§</span> <span class="like-count" id="count-apk1">0</span></div>
          <img src="assets/images/logopsych.png">
          <h3>Psych Engine</h3>
          <button class="btn" onclick="openApkInfo('apk1')">M√°s informaci√≥n</button>
        </div>
        <div class="apk-card">
          <div class="like-container" id="like-apk2" onclick="handleLike('apk2', this)"><span class="like-icon">‚ù§</span> <span class="like-count" id="count-apk2">0</span></div>
          <img src="assets/images/logoonline.png">
          <h3>Psych Online</h3>
          <button class="btn" onclick="openApkInfo('apk2')">M√°s informaci√≥n</button>
        </div>
        <div class="apk-card">
          <div class="like-container" id="like-apk3" onclick="handleLike('apk3', this)"><span class="like-icon">‚ù§</span> <span class="like-count" id="count-apk3">0</span></div>
          <img src="assets/images/logocode.png">
          <h3>CodeName Engine</h3>
          <button class="btn" onclick="openApkInfo('apk3')">M√°s informaci√≥n</button>
        </div>
      </div>
    </section>

    <section id="mods" class="section">
      <h2 class="glow">MODs Disponibles</h2>
      <div class="mods-grid">
        <div class="mod-card"><div class="like-container" id="like-mod1" onclick="handleLike('mod1', this)"><span class="like-icon">‚ù§</span> <span class="like-count" id="count-mod1">0</span></div><h3>VS Jeffy V3 (BABY BF VS BABY PICO)</h3><button class="btn" onclick="openModInfo('mod1')">M√°s informaci√≥n</button></div>
        <div class="mod-card"><div class="like-container" id="like-mod3" onclick="handleLike('mod3', this)"><span class="like-icon">‚ù§</span> <span class="like-count" id="count-mod3">0</span></div><h3>Cocoa Noimix</h3><button class="btn" onclick="openModInfo('mod3')">M√°s informaci√≥n</button></div>
        <div class="mod-card"><div class="like-container" id="like-mod4" onclick="handleLike('mod4', this)"><span class="like-icon">‚ù§</span> <span class="like-count" id="count-mod4">0</span></div><h3>Vs Metal Pipe V2</h3><button class="btn" onclick="openModInfo('mod4')">M√°s informaci√≥n</button></div>
        <div class="mod-card"><div class="like-container" id="like-mod5" onclick="handleLike('mod5', this)"><span class="like-icon">‚ù§</span> <span class="like-count" id="count-mod5">0</span></div><h3>Rolling Girl</h3><button class="btn" onclick="openModInfo('mod5')">M√°s informaci√≥n</button></div>
        <div class="mod-card"><div class="like-container" id="like-mod6" onclick="handleLike('mod6', this)"><span class="like-icon">‚ù§</span> <span class="like-count" id="count-mod6">0</span></div><h3>Herobrine Reborn Tales (NEW)</h3><button class="btn" onclick="openModInfo('mod6')">M√°s informaci√≥n</button></div>
      </div>
      
      <h2 class="glow" style="margin-top: 50px;">Pr√≥ximos Lanzamientos ‚è≥</h2>
      <div class="mods-grid">
        <div class="mod-card coming-soon-card"><div class="coming-soon-badge">PR√ìXIMAMENTE</div><img src="assets/images/mods/fate.png"> <h3>Vs. Impostor: Tainted Fate</h3><p style="font-size: 12px; color: var(--neon-pink);">Estado: 63% Completado</p></div>
        <div class="mod-card coming-soon-card"><div class="coming-soon-badge">PR√ìXIMAMENTE</div><img src="assets/images/mods/over.jpeg"> <h3>FCR: Overwritten</h3><p style="font-size: 12px; color: var(--neon-pink);">Estado: En desarrollo...</p></div>
      </div>
    </section>

    <section id="comments-area" class="section">
      <h2 class="glow">Comunidad (Beta)</h2>
      <div style="background: rgba(0,0,0,0.4); padding: 20px; border-radius: 12px; margin-bottom: 10px; border: 1px solid var(--neon-blue);">
        <div style="display:flex; gap:12px;">
          <div id="myAvatar" class="yt-avatar" style="background:#555">?</div>
          <div style="flex:1">
            <div id="displayMyName" style="color:var(--neon-blue); font-weight:bold; margin-bottom:10px; font-size:14px;">Usuario: Cargando...</div>
            <textarea id="commentText" placeholder="A√±ade un comentario..." maxlength="100" style="width:100%; background:none; border:none; border-bottom:1px solid #555; color:white; padding:8px 0; outline:none; resize:none;"></textarea>
            <div style="text-align:right; font-size:11px; color:var(--neon-blue); margin-top:5px;"><span id="charCounter">0</span> / 100</div>
            <div style="display:flex; justify-content: flex-end; gap:10px; margin-top:10px;">
              <button class="btn" style="background:#444" onclick="document.getElementById('commentText').value=''">Cancelar</button>
              <button class="btn" onclick="addComment()">Comentar</button>
            </div>
          </div>
        </div>
      </div>
      <div id="commentList"></div>
    </section>

    <section id="contact" class="section">
      <h2 class="glow">Redes Sociales</h2>
      <div class="social-grid">
        <a class="social-item" href="https://youtube.com/@lalocf_1" target="_blank"><img src="assets/icons/youtube.jpeg"><span class="btn">YouTube</span></a>
        <a class="social-item" href="https://t.me/lalo_cf_mods" target="_blank"><img src="assets/icons/telegram.jpeg"><span class="btn">Telegram</span></a>
        <a class="social-item" href="https://instagram.com/lalo_cf1" target="_blank"><img src="assets/icons/instagram.jpeg"><span class="btn">Instagram</span></a>
        <a class="social-item" href="https://tiktok.com/@lalo_cf" target="_blank"><img src="assets/icons/tiktok.jpeg"><span class="btn">TikTok</span></a>
      </div>
    </section>

    <footer style="margin-top:40px; text-align:center; color:white;">
      ¬© <span id="year"></span> LaloCF | V2.3.0 <br>
      <div class="visitor-counter">Visitas: <span>Habilitado</span></div>
    </footer>
  </div>

  <div id="apk-popup" class="popup"><div class="popup-content"><span class="popup-close" onclick="closeApkInfo()">‚úñ</span><div class="popup-scroll-body"><img id="apk-img"><h2 id="apk-title"></h2><p id="apk-desc"></p><h3 id="apk-version" style="color:#00eaff; margin-bottom:10px;"></h3><div id="apk-downloads"></div></div></div></div>
  <div id="mod-popup" class="popup"><div class="popup-content"><span class="popup-close" onclick="closeModInfo()">‚úñ</span><div class="popup-scroll-body"><img id="popup-img"><h2 id="popup-title"></h2><p id="popup-desc"></p><h3 id="popup-version" style="color:#00eaff; margin-bottom:10px;"></h3><div id="popup-downloads"></div></div></div></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, push, onValue, remove, update, runTransaction, get, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCG2_mOYbHLkCB5xcaker4mR7KJZVt0zRM",
      authDomain: "fnf-mobile-lalocf.firebaseapp.com",
      databaseURL: "https://fnf-mobile-lalocf-default-rtdb.firebaseio.com",
      projectId: "fnf-mobile-lalocf",
      storageBucket: "fnf-mobile-lalocf.firebasestorage.app",
      messagingSenderId: "407243542354",
      appId: "1:407243542354:web:0da0f6a80db245f6bb348b"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const APP_VERSION = "v2.3.0";
    let isSuperUser = localStorage.getItem('superUser') === 'true';

    async function checkBanStatus() {
      const profile = JSON.parse(localStorage.getItem('fnf_user_profile'));
      if (!profile) return false;
      const snap = await get(ref(db, `banned_users/${profile.key}`));
      if (snap.exists()) {
        const banData = snap.val();
        if (Date.now() < banData.expiresAt) {
          const timeLeft = Math.ceil((banData.expiresAt - Date.now()) / 3600000);
          alert(`‚õî ACCESO DENEGADO\nHas sido baneado por incumplir las normas.\nMotivo: ${banData.reason}\nExpira en: ${timeLeft}h`);
          return true;
        } else {
          await set(ref(db, `banned_users/${profile.key}`), null);
          return false;
        }
      }
      return false;
    }

    window.openBanPanel = (userKey, userName) => {
      if (!isSuperUser) return;
      document.getElementById('ban-target-info').innerText = `Gestionando a: ${userName}`;
      document.getElementById('ban-popup').classList.add('show');
      document.getElementById('confirmBanBtn').onclick = async () => {
        const reason = document.getElementById('banReason').value || "Infracci√≥n de t√©rminos";
        const hours = parseInt(document.getElementById('banDuration').value) || 24;
        await set(ref(db, `banned_users/${userKey}`), {
          userName, reason, expiresAt: Date.now() + (hours * 3600000)
        });
        alert("Usuario baneado correctamente.");
        document.getElementById('ban-popup').classList.remove('show');
      };
    };

    function checkUserStatus() {
      const user = JSON.parse(localStorage.getItem('fnf_user_profile'));
      if(!user) {
        document.getElementById('register-popup').classList.add('show');
      } else {
        updateCommentInterface(user);
        syncLikeButtons();
      }
    }

    function updateCommentInterface(user) {
      const display = document.getElementById('displayMyName');
      display.innerText = "Comentando como: " + user.name;
      if(user.name.toLowerCase() === 'lalocf') display.classList.add('admin-name');
      const avatar = document.getElementById('myAvatar');
      avatar.innerText = user.name.charAt(0).toUpperCase();
      avatar.style.background = stringToColor(user.name);
    }

    window.saveRegistration = () => {
      const name = document.getElementById('regName').value.trim();
      const link = document.getElementById('regLink').value.trim() || "#";
      if(name.length < 3) return alert("El nombre debe tener al menos 3 caracteres.");
      const profile = { name, link, key: 'user_' + Math.random().toString(36).substr(2, 9) };
      localStorage.setItem('fnf_user_profile', JSON.stringify(profile));
      document.getElementById('register-popup').classList.remove('show');
      location.reload();
    };

    let holdTimer;
    const fnfTitle = document.getElementById('fnf-title');
    const _0xd1a4 = "bGFsb2NmbW9kczE=";

    fnfTitle.addEventListener('mousedown', startHold);
    fnfTitle.addEventListener('mouseup', endHold);
    fnfTitle.addEventListener('touchstart', startHold);
    fnfTitle.addEventListener('touchend', endHold);

    function startHold() { holdTimer = setTimeout(() => { document.getElementById('admin-popup').classList.add('show'); }, 5000); }
    function endHold() { clearTimeout(holdTimer); }

    window.verifyAdmin = () => {
      const input = document.getElementById('adminCode').value;
      if(btoa(input) === _0xd1a4) {
        localStorage.setItem('superUser', 'true');
        alert("Nivel de acceso actualizado.");
        location.reload();
      } else { alert("Error de validaci√≥n de sistema: 403"); }
    };

    function stringToColor(str) {
      let hash = 0; for (let i = 0; i < str.length; i++) { hash = str.charCodeAt(i) + ((hash << 5) - hash); }
      return `hsl(${hash % 360}, 65%, 50%)`;
    }

    onValue(ref(db, 'comments'), (snapshot) => {
      const list = document.getElementById('commentList');
      list.innerHTML = '';
      const data = snapshot.val();
      const myProfile = JSON.parse(localStorage.getItem('fnf_user_profile'));
      if(data) {
        Object.keys(data).reverse().forEach(id => {
          const c = data[id];
          const isLalo = c.user.toLowerCase() === 'lalocf';
          const myLikedComments = JSON.parse(localStorage.getItem('my_liked_comments') || '{}');
          const activeClass = myLikedComments[id] ? 'active' : '';

          const div = document.createElement('div');
          div.className = 'yt-comment-container';
          div.innerHTML = `
            <div class="yt-avatar" style="background:${stringToColor(c.user)}">${c.user.charAt(0).toUpperCase()}</div>
            <div class="yt-content">
              <div class="yt-header">
                <span class="yt-name ${isLalo ? 'admin-name' : ''}" onclick="openBanPanel('${c.ownerKey}', '${c.user}')">
                  <a href="${c.link || '#'}" target="_blank" class="yt-name-link">${c.user}</a>
                </span>
                <span class="yt-date">${c.date}</span>
              </div>
              <div class="yt-text">${c.text}</div>
              <div class="yt-actions">
                <span class="yt-action-btn ${activeClass}" id="btn-like-${id}" onclick="likeComment('${id}')">üëç <span id="l-count-${id}">${c.likes || 0}</span></span> 
                <span class="yt-action-btn" onclick="replyComment('${c.user}')">Responder</span>
                ${(isSuperUser || (myProfile && c.ownerKey === myProfile.key)) ? `<span style="color:red; cursor:pointer" onclick="deleteComment('${id}')">Eliminar</span>` : ''}
              </div>
            </div>`;
          list.appendChild(div);
        });
      }
    });

    window.addComment = async () => {
      if (await checkBanStatus()) return;
      const profile = JSON.parse(localStorage.getItem('fnf_user_profile'));
      const text = document.getElementById('commentText').value.trim();
      if(!profile) return checkUserStatus();
      if(!text) return alert("Escribe algo...");
      push(ref(db, 'comments'), { ownerKey: profile.key, user: profile.name, link: profile.link, text, date: new Date().toLocaleString(), likes: 0 });
      document.getElementById('commentText').value = '';
    };

    window.likeComment = async (commentId) => {
      if (await checkBanStatus()) return;
      const profile = JSON.parse(localStorage.getItem('fnf_user_profile'));
      if(!profile) return checkUserStatus();
      const userKey = profile.key;
      const myLikedComments = JSON.parse(localStorage.getItem('my_liked_comments') || '{}');
      const likeRef = ref(db, `comments/${commentId}/userLikes/${userKey}`);
      const snap = await get(likeRef);
      if (snap.exists()) {
        await set(likeRef, null); runTransaction(ref(db, `comments/${commentId}/likes`), (c) => (c || 1) - 1);
        delete myLikedComments[commentId];
      } else {
        await set(likeRef, true); runTransaction(ref(db, `comments/${commentId}/likes`), (c) => (c || 0) + 1);
        myLikedComments[commentId] = true;
      }
      localStorage.setItem('my_liked_comments', JSON.stringify(myLikedComments));
    };

    window.handleLike = async (id, el) => {
      if (await checkBanStatus()) return;
      const profile = JSON.parse(localStorage.getItem('fnf_user_profile'));
      if(!profile) return checkUserStatus();
      const userKey = profile.key;
      const myLikedItems = JSON.parse(localStorage.getItem('my_liked_items') || '{}');
      const itemLikeRef = ref(db, `likes_registry/${id}/${userKey}`);
      const snap = await get(itemLikeRef);
      if (snap.exists()) {
        await set(itemLikeRef, null); runTransaction(ref(db, `likes/${id}`), (c) => (c || 1) - 1);
        delete myLikedItems[id]; el.classList.remove('active');
      } else {
        await set(itemLikeRef, true); runTransaction(ref(db, `likes/${id}`), (c) => (c || 0) + 1);
        myLikedItems[id] = true; el.classList.add('active');
      }
      localStorage.setItem('my_liked_items', JSON.stringify(myLikedItems));
    };

    function syncLikeButtons() {
      const myLikedItems = JSON.parse(localStorage.getItem('my_liked_items') || '{}');
      Object.keys(myLikedItems).forEach(id => {
        const btn = document.getElementById('like-' + id);
        if(btn) btn.classList.add('active');
      });
    }

    window.replyComment = (name) => { const txt = document.getElementById('commentText'); txt.value = `@${name} `; txt.focus(); };
    window.deleteComment = (id) => confirm("¬øBorrar?") && remove(ref(db, 'comments/'+id));

    const MOD_DATA = {
  mod1: {
    img: "assets/images/mods/logojeffy.jpeg",
    title: "VS Jeffy V3 (BABY BF VS BABY PICO)",
    desc: "Friday Night Funkin' FNF' Vs Jeffy V3 Port Psych Engine Optimizado Para (Pc/Android).",
    version: "Engine v1.0.4",
    downloads: [{ name: "Descarga", link: "assets/zip/VS Jeffy V3 (BABY BF VS BABY PICO).zip" }]
  },
  mod2: {
    img: "assets/images/mods/logonusky.jpeg",
    title: "VS Nusky",
    desc: "Friday Night Funkin' FNF' Vs Nusky Mod Psych Engine Optimizado Para (Pc/Android).",
    version: "Engine v1.0.4",
    downloads: [
      { name: "Descarga", link: "https://github.com/LaloCF2/Mods-Psych-Engine/releases/download/Ports/Vs.Nusky.zip" },
      { name: "Descarga (GameBanana)", link: "https://gamebanana.com/mods/369981" }
    ]
  },
  mod3: {
    img: "assets/images/mods/chritmas.jpeg",
    title: "Cocoa Noimix",
    desc: "Friday Night Funkin' FNF' Cocoa Noimix Port Psych Engine Optimizado Para (Pc/Android/iOS).",
    version: "Engine v1.0.4",
    downloads: [
      { name: "Descarga (GameBanana)", link: "https://gamebanana.com/mods/643242" },
      { name: "Descarga Directa (Drive)", link: "https://drive.usercontent.google.com/u/0/uc?id=1wnnGhworUMdReUrlEMMh5C4in4OoHHrU&export=download" },
      { name: "Descarga Directa iOS (Drive)", link: "https://drive.usercontent.google.com/u/0/uc?id=11AUlGXUvPrxszI5xnjssMS5OvZDFp64_&export=download" },
      { name: "Descarga Directa Opt (Drive)", link: "https://drive.usercontent.google.com/u/0/uc?id=1EO-TOh4KByE0gSf24DXx2pG10WR8wdhU&export=download" }
    ]
  },
  mod4: {
    img: "assets/images/mods/metal.png",
    title: "Vs Metal Pipe V2",
    desc: "Friday Night Funkin' FNF' Vs Metal Pipe V2 Port Psych Engine Optimizado Para (Pc/Android) y en especial iOS.",
    version: "Engine v1.0.4",
    downloads: [
      { name: "Descarga (GameBanana)", link: "https://gamebanana.com/mods/441630"},
      { name: "Descarga Directa (Drive)", link: "https://drive.usercontent.google.com/u/0/uc?id=1g5liWScsGSSd_FCmDtLEOVPQSQtp6E8B&export=download"}
    ]
  },
  mod5: {
    img: "assets/images/mods/Girl.png",
    title: "Rolling Girl",
    desc: "Friday Night Funkin' FNF' Rolling Girl Port Psych Engine Optimizado Para (Pc/Android/iOS).",
    version: "Engine v1.0.4",
    downloads: [
      { name: "Descarga (GameBanana)", link: "https://gamebanana.com/mods/42313?lang=es" },
      { name: "Descarga Directa (Drive)", link: "https://drive.usercontent.google.com/u/0/uc?id=1n_e-lmvGFeIybTIDkdHXnduEIeXziD8I&export=download" }
    ]
  },
  mod6: {
    img: "assets/images/mods/Tales.png",
    title: "Herobrine Reborn Tales",
    desc: "Friday Night Funkin' FNF' Herobrine Reborn Tales Port Psych Engine Para (Pc/Android/iOS).",
    version: "Engine v1.0.4",
    downloads: [
      { name: "Espera a que se termine el estreno."}
    ]
  }
};

    const APK_DATA = {
  apk1: {
    img: "assets/images/logopsychengine.png",
    title: "Psych Engine",
    desc: "Motor usado originalmente en Mind Games Mod, concebido para solucionar los numerosos problemas de la versi√≥n original, manteniendo el aspecto de juego casual. Tambi√©n busca ser una alternativa m√°s sencilla para programadores principiantes.",
    version: "v1.0.4",
    downloads: [
      { name: "Descarga Windows64 (Github)", link: "https://github.com/ShadowMario/FNF-PsychEngine/releases/download/1.0.4/PsychEngine-Windows64.zip" },
      { name: "Descarga Windows32 (Github)", link: "https://github.com/ShadowMario/FNF-PsychEngine/releases/download/1.0.4/PsychEngine-Windows32.zip" },
      { name: "Descarga Linux (Github)", link: "https://github.com/ShadowMario/FNF-PsychEngine/releases/download/1.0.4/PsychEngine-Linux.zip"},
      { name: "Descarga Mac (Github)", link: "https://github.com/ShadowMario/FNF-PsychEngine/releases/download/1.0.4/PsychEngine-MacOS.zip"},
      { name: "Descarga Android (Github)", link: "https://github.com/LaloCF2/LaloCF/releases/download/Psych-Engine-v1.0.4/Psych.Engine.v1.0.4.Android.apk" },
      { name: "Descarga iOS (Github)", link: "https://github.com/LaloCF2/LaloCF/releases/download/Psych-Engine-v1.0.4/PsychEngine.v1.0.4.iOS.ipa" }
    ]
  },
  apk2: {
    img: "assets/images/logopsychonline.png",
    title: "Psych Online",
    desc: "Mod de Psych Engine con funciones en l√≠nea.",
    version: "v0.13.2 Bugfix",
    downloads: [
      { name: "Descarga Windows (Github)", link: "https://github.com/Snirozu/Funkin-Psych-Online/releases/download/0.13.2/windowsBuild.zip" },
      { name: "Descarga Linux (Github)", link: "https://github.com/Snirozu/Funkin-Psych-Online/releases/download/0.13.2/linuxBuild.zip" },
      { name: "Descarga Mac (Github)", link: "https://github.com/Snirozu/Funkin-Psych-Online/releases/download/0.13.2/macBuild.zip"},
      { name: "Descarga Android (Github)", link: "https://github.com/Prohack202020/Funkin-Psych-Online/releases/download/0.13.2-bugfix-mobile/PsychOnline-Android.apk" },
      { name: "Descarga iOS (Github)", link: "https://github.com/Prohack202020/Funkin-Psych-Online/releases/download/0.13.2-bugfix-mobile/PsychOnline-iOS.ipa" }
    ]
  },
  apk3: {
    img: "assets/images/logocodename.png",
    title: "CodeName Engine",
    desc: "Codename Engine es una bifurcaci√≥n de Friday Night Funkin' con un enfoque en codificaci√≥n suave y modding.",
    version: "v1.0.1",
    downloads: [
      { name: "Descarga Windows (Github)", link: "https://github.com/CodenameCrew/CodenameEngine/releases/download/v1.0.1/Codename.Engine-Windows.zip" },
      { name: "Descarga Linux (Github)", link: "https://github.com/CodenameCrew/CodenameEngine/releases/download/v1.0.1/Codename.Engine-Linux.zip" },
      { name: "Descarga Mac (Github)", link: "https://github.com/CodenameCrew/CodenameEngine/releases/download/v1.0.1/Codename.Engine-Mac.zip"},
      { name: "Descarga Android (Github)", link: "https://github.com/CPsP-Team/CodenameEngine-Mobile/releases/download/v1.0.1-mobile/CodenameEngineAndroid.apk"},
      { name: "Descarga iOS (Github)", link: "https://github.com/CPsP-Team/CodenameEngine-Mobile/releases/download/v1.0.1-mobile/CodenameEngineiOS.ipa" }
    ]
  }
};

    window.openModInfo = (id) => { const d = MOD_DATA[id]; document.getElementById("popup-img").src = d.img; document.getElementById("popup-title").innerText = d.title; document.getElementById("popup-desc").innerText = d.desc; document.getElementById("popup-version").innerText = d.version; let h = ""; d.downloads.forEach(dl => { h += `<a class="btn" style="display:block; margin-top:10px" href="${dl.link}" target="_blank">${dl.name}</a>`; }); document.getElementById("popup-downloads").innerHTML = h; document.getElementById("mod-popup").classList.add("show"); };
    window.closeModInfo = () => document.getElementById("mod-popup").classList.remove("show");

    window.openApkInfo = (id) => { const d = APK_DATA[id]; document.getElementById("apk-img").src = d.img; document.getElementById("apk-title").innerText = d.title; document.getElementById("apk-desc").innerText = d.desc; document.getElementById("apk-version").innerText = d.version; let h = ""; d.downloads.forEach(dl => { h += `<a class="btn" style="display:block; margin-top:10px" href="${dl.link}" target="_blank">${dl.name}</a>`; }); document.getElementById("apk-downloads").innerHTML = h; document.getElementById("apk-popup").classList.add("show"); };
    window.closeApkInfo = () => document.getElementById("apk-popup").classList.remove("show");

    window.toggleTheme = () => document.body.classList.toggle("light");
    window.toggleMenu = () => document.getElementById("menuPopup").classList.toggle("show");
    window.selectSection = (id) => { document.querySelectorAll(".section").forEach(s => s.classList.remove("active")); document.getElementById(id).classList.add("active"); toggleMenu(); };
    onValue(ref(db, 'likes'), (s) => { const d = s.val() || {}; Object.keys(d).forEach(k => { if(document.getElementById('count-'+k)) document.getElementById('count-'+k).innerText = d[k]; }); });
    
    window.onload = () => {
      document.getElementById("year").textContent = new Date().getFullYear();
      if (localStorage.getItem('lastVersionSeen') !== APP_VERSION) document.getElementById('update-popup').classList.add('show');
      else checkUserStatus();
    };
    window.closeUpdatePopup = () => { document.getElementById('update-popup').classList.remove('show'); localStorage.setItem('lastVersionSeen', APP_VERSION); checkUserStatus(); };
    document.getElementById('commentText').addEventListener('input', function() { document.getElementById('charCounter').innerText = this.value.length; });
  </script>
</body>
</html>